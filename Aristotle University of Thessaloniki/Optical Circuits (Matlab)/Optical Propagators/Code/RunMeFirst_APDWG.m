% #########################################################################
% ???? ????? ??? ?????????? MATLAB-script ??? ?? ????? ??? ???????? APDWG
% (Asymmetric Planar Dielectric Waveguides).
% #########################################################################
%
% ???????: ??? ???????? ??? script, ????????? ?? m-file ???? ?? ????????? 
% ???? ???? ?????? ?? ??? ??????? APDWG.m, ??? 
% -? ??????? F5 ??? ???????????? (windows) ??? ????? ???? MATLAB-editor,
% -? ???? ??? ???????? "Save & Run" ??? user-interface ??? MATLAB-editor,
% -? ??????? ?? ??????? ??? ?? MATLAB-command-window ("RunMeFirst_APDWG").
%
% *** ?? ?????? ?????? ?? ????? "pause" (????? ?? ??????? ?????? ??? 
%     command window), ????? ?? ?????? ?? ???????? ?????? ??????? ??? ?? 
%     ?????????, ???? ????????? ?? ????????? ??????/????????? ???? ?? ????  
%     ?? m-file.
%
% *** ??? ???? ??? ???????? MATLAB ??? ???????????????? ??? script ????,
%     ???????? ?? ?????? ???????? ??????????? ??? ?? help ??? ???????????? 
%     (?? "help FUNCTIONNAME" ? "doc FUNCTIONNAME" ??? ?? command-window).
% 
% Comments, remarks, corrections : alexpiti@auth.gr
%
% Alexandros Pitilakis, Thessaloniki, March 2013
% ** Update May 2015: Typos corrected Thanks Marianna!)

clc; close all; % <--- ????????? ?? commmand-window & ??? ?? figure

% =========================================================================
% ??? ???? ?????????? ??????????? ?/?
% =========================================================================
disp( '  ======== A Single-Mode APDWG Example ======== ' )
% ??? command-window ???????????? ?? ?????????? ??? ??????????? (??? ??
% ???????? ??????? ???? APDW). ??? figure ??? ??????? (?????? maximize): 
% ?????, ???????? ?? ?????????????? ??????? (??) ??? ?? & ?? ???????, ?? 
% ?????? ????????-????? neff (??? ??? ????????, ??????? ?? ??? ???????????
% ??? ??). ??? ?????? ??? ? ??????? ??????? ??? ?? ?????, ?????? ???? ??? 
% ??, ??? ?????????? ?????. ????, ???????? ?? ?????? ??? ???????-??????????
% ??? ??.?????? ??? ??? ?????? ?? & ?? ?????.
APDWG;
pause
% ??? ???????? ??????????? ??? ??? APDWG, ???????? ?? help ??? ????????
% ???/? ??? ??????.

% =========================================================================
% ?????????? ????????? ???????? APDWG:
% =========================================================================
disp(' ');
disp( '  ======== A Multimode APDWG Introduction ======== ' )

% ?? ???????? ??????? ???? APDWG, ??????? ?? ????? ??????? (wl), ?? ????? 
% ??? ????????? ???????? (h), ????? ??? ???? ????? ??????? ????????? 
% (n1=???.????????, n2=?????????, n3=?????????). ? ??????? ??? ?????????? 
% ???? ????????-???????-????????? (neff) ??? ????? ???? ???????????? 
% ???????, ?? & ??, ??? APDWG. ??? ????????/??????? ? ?? ???????? ??????? 
% (x), ???? ? ??????? ?? ??? ?????????? ?????? ??? ?? ?????? ??? Ey (? Hy) 
% ?????????? ??? ???? TE (? TM) ???????, ??? ?????? ??? ????????? ????? x.

% *** ???????: ?? ???????-???????? ??? ?? wl,h,x ????? ?? ?????, ??? ??
%     ???????? ???? ?????? ?? ????? ??? ????? ????? ????????.

% *** ???????: ?? ??????????? ?????? (?? 2.10) ????? ????? ??? ?????? ?? 
%     ??????? ??????? (n_eff) ???????: n_eff<n1 ??? n_eff>max([n2,n3]) 

% ?? ????? ????? ????????-??????? ??? APDWG ????? ??????? (scalar), ???:
disp( '  ** APDWG Parameters ** ')
wl = 1.55 % [?m] ????? ???????
h  = 0.3 % [?m] ????? ???????? ????????
n1 = 3.45 % [.]="??????? ???????" ??????? ?????. ????.
n2 = 1.45 % [.]="??????? ???????" ??????? ????????.
n3 = 1.34 % [.]="??????? ???????" ??????? ????????.

% ?? ????????-??????? ????? ??????? ?????????? 1-???-? (?? ?=1000).
x  = linspace( -2*h , +2*h , 1000 ); % [?m]

% ????? ??? APDWG:
[ neff_TE , neff_TM , Ey_TE , Hy_TM ] = APDWG( wl , h , n1 , n2 , n3 , x );

% ????? ?????? ?? & ?? ??????????????? ????? ?? ??????? ???? ????????
fprintf( '  Number of TE-modes supported = %d\n' , length(neff_TE) )
for k1 = 1:length(neff_TE)
    fprintf( '     n_eff of mode TE%d : %6.4f\n' , k1-1 , neff_TE(k1) )
end
fprintf( '  Number of TM-modes supported = %d\n' , length(neff_TM) )
for k2 = 1:length(neff_TM)
    fprintf( '     n_eff of mode TM%d : %6.4f\n' , k2-1 , neff_TM(k2) )
end

% ??? ???????? ?? ?????? ??? ?????? ??????
figure
subplot(2,1,1);
plot( x , Ey_TE , 'o-' , 'MarkerSize' , 2 , 'MarkerFaceColor' , 'w' )
xlabel( 'x-dimension (um)' )
ylabel( 'E_y(x) for TE-modes' )
legend( [repmat('TE-',[k1,1]),num2str( (0:k1-1)' )] ) % ??????? ???? ???????????? ???????
hold on; plot( -h/2*[1 1],[-1 1],'k-',+h/2*[1 1],[-1 1],'k-') % x-???? ???????? ????????

subplot(2,1,2);
plot( x , Hy_TM , 'o-' , 'MarkerSize' , 2 , 'MarkerFaceColor' , 'w' )
xlabel( 'x-dimension (um)' )
ylabel( 'H_y(x) for TM-modes' )
legend( [repmat('TM-',[k2,1]),num2str( (0:k2-1)' )] ) % ??????? ???? ???????????? ???????
hold on; plot( -h/2*[1 1],[-1 1],'k-',+h/2*[1 1],[-1 1],'k-') % x-???? ???????? ????????

% ??????????? ??? ?? ?????? "??????/????????" ????? (0,2,.../1,3,..) ?????
% ??????????/?????????????? ?????? (???? ??? x-?????) ?? ???? ?? ?????? 
% ??? ???????? ???????? (x=0). ?????? ? ?/? ??? ????? ??????? ???????????
% (n2 ????? ??? n3) ?? ??????-?????????? ??? ????? ??????? ??? x=0.

% ???? ????? ? ??????????? ??? ?????? ???? ??? ?????? ????????? ?? ????????
% ??? "??????" (?, Intensity) ??? ?????? ?? |F|^2, ???? F=Ey_TE ? Hy_TM:
icore = x>=-h/2 & x<=+h/2 ; % Boolen-vector: ???????? ??? ?? x ? ?? ????? "1" ???? ??? ???. ????????
disp(' ');
disp( '  Modal-Confinement Estimation: ' )
for k1 = 1:length(neff_TE)
    I_tot = trapz( x , abs(Ey_TE(k1,:)).^2 ); 
    I_cor = trapz( x(icore) , abs(Ey_TE(k1,icore)).^2 );
    fprintf( '     Mode TE%d |Ey|^2 in-core/total ratio : %6.4f\n' , k1-1 , I_cor/I_tot )
end
disp(' ');
for k2 = 1:length(neff_TM)
    I_tot = trapz( x , abs(Hy_TM(k2,:)).^2 ); 
    I_cor = trapz( x(icore) , abs(Hy_TM(k2,icore)).^2 );
    fprintf( '     Mode TM%d |Hy|^2 in-core/total ratio : %6.4f\n' , k2-1 , I_cor/I_tot )
end

pause
% =========================================================================
% ??????????? ?????????
% =========================================================================
disp(' ');
disp( '  ======== SPDWG Dipsersion-Curve ======== ' )

% ?? ??? ????????? ????????? ???????? ??? ????????? ? ?????? ??????? ?
% (? ? ??????? ???????, neff, ?? ?=k0*neff ??? k0=2*pi/wl) ?? ????? ?? ?? 
% ????????? (f ? ?=2*??*f ? ?? ????? ???????). ??? ?? ????????? ??? 
% ????????? ?????????, ?? ?????? ?? "????????" ?????? ????? ??? APDWG 
% ?????????? ???? ?? ????? ???????. 
%
% ??? ???????????, ? ???????? ????? ? ???????? ??????? ??????????????? ???
% ???????????-?????? ???? ?/? (?? ?? neff, ? "??????? ????????? ??????", ?
% ? ???????????-?????? ????? ??????) ??? ????????? ???? ?????????? ??? 
% ??????????? (?? ? ????????? ???????????, ?? ??????????? ??????????, ??
% ?????????????? ??? ?????? [??????? ?????????] ??? ??? ?????????).

% ?? ?????????? ???? ?????? ?????????-????????? ?-? ??? ?? ??????, ???? 
% ?????????? ????????? ??? ??????????? ?/? ?????? (n2==n3), ??? "SPDWG".
h = 0.4;
n3 = 1;
n2 = 1;

% ??? ?? ???????????? ?? ????????? ?-? ??. 2.9, ???????? ?????? ??? ?????
% ?????????? (?), ???? ?? ???????????????? ?? ????-??????? (?, ?? ?m, ?????
% ?? ???? ???????? ? ??????? APDWG) ? ????????? ???? ?? ????-??????? 
% ????????? ??? APDWG ?? ??? ?????????? ?? n-effective. ????? ?=neff*2*pi/?
c0    = 3e8; % [m/sec] Speed-of-ligh
omega = linspace( eps , 2.5e15 , 100 );% [rad/sec] angular velocities ?=k0*c0=2*pi/wl*c0
k0s   = omega / c0; % [1/m] free-space wavenumbers
wls   = 2*pi*c0./omega * 1e6; % [?m] wavelengths (free-space)

% ???????????? ??? ?????? ??????????? ??? ????????????? (??? ?? n-eff)
% ??? max 4 ?? ???????????? ???????
neffs_TE = NaN*zeros( length(wls) , 4 ); 
for k = 1:length(wls) % ?????? ??? ?????-???????
    [ neff_TE ] = APDWG( wls(k) , h , n1 , n2 , n3 ); % ????? ??? APDWG    
    neffs_TE(k,1:length(neff_TE)) = neff_TE; % ?????????? ?????????????
end
beta = neffs_TE .* repmat( k0s(:) , [1,size(neffs_TE,2)] ); % [rad/m] phase-constants

% ?? ???????????? ?? ????????? ????????? (??. 2.9)
figure;
subplot(1,2,1)
plot( beta , omega ); hold on;
legend( [repmat('TE-',[4,1]),num2str( (0:4-1)' )] )
plot( beta , beta*c0/n1 , 'k--' ) % ? ?????? ??? ?????? ??? ??????? "??????" ????? ??????
plot( beta , beta*c0/n2 , 'k:' ) % ? ?????? ??? ?????? ?? ???? ???????? ("???????" ????? ??????) 
xlabel( '\beta (rad/m)')
ylabel( '\omega (rad/sec)')
set( gca , 'YLim' , [0,max(omega)] )

% ?? ?? ????? ??? ???? "????????????????" ????? b-vs-V
V = 0.5*(2*pi./wls)*h*sqrt(n1^2-n2^2);
b = real( sqrt( neffs_TE.^2 - n2.^2 ) / sqrt( n1^2 - n2^2 ) );
subplot(1,2,2)
plot( V , b ); hold on;
legend( [repmat('TE-',[4,1]),num2str( (0:4-1)' )] )
xlabel( 'Normalized Frequency "V-number" (.)')
ylabel( 'Normalized Propagation-Constant "b" (.)')
set( gca , 'YLim' , [0,1] )

% ???????: ??? ??? SPDWG, ??????? ??? ?? ?????? ??? ??????????? ???? ????
% ??????????? ?? ?????? ???? ???? ??? ? ???????????????? ????????? (??????? 
% "V") ????????? ?????? ??????? ???/??? ??? ?/2 (??. 2.40-42). ’??, ??? 
% ???? ??????? ???????? ??????? ?? ??????: 
%         V = 0.5*k0*h*sqrt(n1^2-n2^2) == [0:3]*pi/2 ==>
%     ==> ?_cutoff = ( 2*c0/h/sqrt(n1^2-n2^2) )*[0:3]*pi/2
% ????, ??? ???????? ?????????-????????? ??? ????????, ??? ?????? zoom ???
% ?????? ??? "???????????" ?? ????????-????????? ??? ??? ?????? c0/n2 (--), 
% ?? ?????? ?? ?????? ???? y-????? (?) ??????? ?? ???????? ???????:
omega_cutoff = ( 2*c0/h/1e-6/sqrt(n1^2-n2^2) )*[0:3]'*pi/2;
for km=0:3
    fprintf( '  ** Mode TE-%d cutoff @ omega = %4.2e [rad/sec]\n' , km , omega_cutoff(km+1) );
end
% ??????, ??? ???? "????????????????" ?????????-?????????, ?? ???????????
% ???????? ?????? ?? "???????????" ??? ?? ?????? V=0,pi/2,pi,3*pi/2





